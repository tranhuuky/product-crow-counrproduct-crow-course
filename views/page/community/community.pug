extends ../../layout/default.pug
include ../../mixin/alert.pug


block style
    link(rel="stylesheet" href="./css/community.css")


block main
    +alert-success(5000)
    +alert-error(5000)
    .container(style="margin-top: 80px;")
        
        // ƒêƒÉng b√†i vi·∫øt
        .block-create-post
            .user-avatar
                if user && user.avatar
                    img(src=user.avatar, alt="User Avatar")
                else
                    img(src="/img/Avata.png", alt="User Avatar")
                input.post-input(placeholder="B·∫°n ƒëang nghƒ© g√¨ th·∫ø?" readonly id="postInput")
            .post-options
                .option
                    img(src="/img/Live.png" alt="Video tr·ª±c ti·∫øp")
                    span Video tr·ª±c ti·∫øp
                .option
                    img(src="./img/TepAnh.png" alt="·∫¢nh/video")
                    span ·∫¢nh/video
                .option
                    img(src="/img/M·∫∑tcuoi.png" alt="C·∫£m x√∫c/ho·∫°t ƒë·ªông")
                    span C·∫£m x√∫c/ho·∫°t ƒë·ªông
        
        #postPopup.post-popup(style="display: none;")
            .popup-content
                h2 T·∫°o b√†i vi·∫øt
                form#postForm(action="/community/create-post" method="POST" enctype="multipart/form-data")
                    .form-group
                        label(for="caption") Ti√™u ƒë·ªÅ
                        input#caption(type="text" name="caption" placeholder="Ti√™u ƒë·ªÅ b√†i vi·∫øt" required)
                    .form-group
                        label(for="desc") N·ªôi dung
                        textarea#desc(name="desc" placeholder="B·∫°n ƒëang nghƒ© g√¨?" rows="4" required)
                    .form-group
                        label(for="img") Hinh ·∫£nh
                        input#img(type="file" name="img" accept="image/*")
                    .form-actions
                        button.cancel-btn(type="button") H·ªßy
                        button(type="submit") ƒêƒÉng b√†i

        // Duy·ªát b√†i vi·∫øt
        each post in posts
            .post(data-post-id=post._id)
                .post-header
                    - var postDate = post.createdAt ? new Date(post.createdAt).toLocaleDateString("vi-VN") : "Ng√†y kh√¥ng h·ª£p l·ªá";
                    span.date= postDate
                    span.separator ‚Ä¢
                    span.read-time 30 ph√∫t
                    a.category(href="") H·ªçc T·∫≠p

                .post-content
                    .left
                        h2= post.caption
                        p= post.desc
                        if post.img
                            .post-image
                                img(src=post.img, alt="H√¨nh ·∫£nh b√†i vi·∫øt")

                    .right
                        .user-profile
                            if post.author
                                img.avatar(src=post.author.avatar, alt="User Avatar")
                                span.username= post.author.username
                            
                        .post-options-menu
                            button.options-btn
                                img(src="/img/Dau33.png", alt="T√πy ch·ªçn")
                            if user && post.author && user._id.toString() === post.author._id.toString()
                                .options-dropdown(style="display: none;")
                                    button.edit-btn(data-post-id=post._id) Ch·ªânh s·ª≠a
                                    button.delete-btn(data-post-id=post._id) X√≥a

                        .likes
                            button.like-btn(data-post-id=post._id class=(user && post.likes && post.likes.includes(user._id)) ? "liked" : "")
                                span ‚ù§Ô∏è
                            span.likes-count= (post.likes && post.likes.length) ? post.likes.length : 0
                            button üí¨
                            span= (post.comments && post.comments.length) ? post.comments.length : 0

                        .comments
                            if post.comments && post.comments.length > 0
                                each comment in post.comments
                                    .comment
                                        .user-info
                                            if comment.author
                                                img.avatar(src=comment.author.avatar, alt="User Avatar")
                                                span.by by
                                                span.username= comment.author.username
                                                - var commentDate = comment.createdAt ? new Date(comment.createdAt).toLocaleDateString("vi-VN") : "Kh√¥ng x√°c ƒë·ªãnh";
                                                span.time / #{commentDate}
                                        p= comment.text
                            else
                                p Ch∆∞a c√≥ b√¨nh lu·∫≠n n√†o h√£y l√† ng∆∞·ªùi ƒë·∫ßu ti√™n b√¨nh lu·∫≠n!
                            .comment-box
                                if user
                                    img.avatar(src=user.avatar, alt="User Avatar")
                                    input.comment-text(type="text" placeholder="Vi·∫øt b√¨nh lu·∫≠n...")
                                    button.comment-submit ƒêƒÉng


block script
    script(src="./js/communitycouser/community.js" type="module")